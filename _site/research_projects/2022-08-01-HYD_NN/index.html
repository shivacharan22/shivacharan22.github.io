<!DOCTYPE html>
<html lang="en"><!--
 __  __                __                                     __
/\ \/\ \              /\ \             __                    /\ \
\ \ \_\ \   __  __    \_\ \      __   /\_\      __       ___ \ \ \/'\
 \ \  _  \ /\ \/\ \   /'_` \   /'__`\ \/\ \   /'__`\    /'___\\ \ , <
  \ \ \ \ \\ \ \_\ \ /\ \L\ \ /\  __/  \ \ \ /\ \L\.\_ /\ \__/ \ \ \\`\
   \ \_\ \_\\/`____ \\ \___,_\\ \____\ _\ \ \\ \__/.\_\\ \____\ \ \_\ \_\
    \/_/\/_/ `/___/> \\/__,_ / \/____//\ \_\ \\/__/\/_/ \/____/  \/_/\/_/
                /\___/                \ \____/
                \/__/                  \/___/

Powered by Hydejack v9.1.6 <https://hydejack.com/>
-->







<head>
  




  <meta name="robots" content="noindex">



  
    
<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>A Hybrid Network Combining Cnn and Transformer Encoder to Classify Mosquitoes Based on Wing Beat Frequencies | shivacharan oruganti</title>
<meta name="generator" content="Jekyll v4.3.2" />
<meta property="og:title" content="A Hybrid Network Combining Cnn and Transformer Encoder to Classify Mosquitoes Based on Wing Beat Frequencies" />
<meta name="author" content="shivacharan oruganti" />
<meta property="og:locale" content="en" />
<meta name="description" content="A Hybrid Network Combining Cnn and Transformer Encoder to Classify Mosquitoes Based on Wing Beat Frequencies" />
<meta property="og:description" content="A Hybrid Network Combining Cnn and Transformer Encoder to Classify Mosquitoes Based on Wing Beat Frequencies" />
<link rel="canonical" href="http://localhost:4000/research_projects/2022-08-01-HYD_NN/" />
<meta property="og:url" content="http://localhost:4000/research_projects/2022-08-01-HYD_NN/" />
<meta property="og:site_name" content="shivacharan oruganti" />
<meta property="og:image" content="http://localhost:4000/assets/img/blog/arc1.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-08-01T00:00:00-04:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="http://localhost:4000/assets/img/blog/arc1.png" />
<meta property="twitter:title" content="A Hybrid Network Combining Cnn and Transformer Encoder to Classify Mosquitoes Based on Wing Beat Frequencies" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"shivacharan oruganti"},"dateModified":"2023-09-07T11:19:31-04:00","datePublished":"2022-08-01T00:00:00-04:00","description":"A Hybrid Network Combining Cnn and Transformer Encoder to Classify Mosquitoes Based on Wing Beat Frequencies","headline":"A Hybrid Network Combining Cnn and Transformer Encoder to Classify Mosquitoes Based on Wing Beat Frequencies","image":{"srcset":{"1060w":"/assets/img/blog/arc1.png","530w":"/assets/img/blog/arc1.png","265w":"/assets/img/blog/arc1.png"},"url":"http://localhost:4000/assets/img/blog/arc1.png","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/research_projects/2022-08-01-HYD_NN/"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/img/prof.JPG"},"name":"shivacharan oruganti"},"url":"http://localhost:4000/research_projects/2022-08-01-HYD_NN/"}</script>
<!-- End Jekyll SEO tag -->


  

  



  <meta name="theme-color" content="rgb(3,29,52)">


<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta http-equiv="x-ua-compatible" content="ie=edge">

<meta name="mobile-web-app-capable" content="yes">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="shivacharan oruganti">
<meta name="apple-mobile-web-app-status-bar-style" content="default">

<meta name="application-name" content="shivacharan oruganti">

<meta name="generator" content="Hydejack v9.1.6" />


<link rel="alternate" href="http://localhost:4000/research_projects/2022-08-01-HYD_NN/" hreflang="en">

<link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="shivacharan oruganti" />


<link rel="shortcut icon"    href="/assets/icons/favicon.ico">
<link rel="apple-touch-icon" href="/assets/icons/icon-192x192.png">

<link rel="manifest" href="/assets/site.webmanifest">

<link rel="dns-prefetch" href="https://fonts.googleapis.com"><link rel="dns-prefetch" href="https://fonts.gstatic.com">



<link rel="preload" href="/assets/img/swipe.svg" as="image" id="_hrefSwipeSVG">






<script>!function(r,c){"use strict";function a(e,t,n,o){e.addEventListener?e.addEventListener(t,n,o):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n}r.loadJS=function(e,t){var n=c.createElement("script"),e=(n.src=e,t&&a(n,"load",t,{once:!0}),c.scripts[0]);return e.parentNode.insertBefore(n,e),n},r._loaded=!1,r.loadJSDeferred=function(e,t){var n=c.createElement("script");function o(){r._loaded=!0,t&&a(n,"load",t,{once:!0});var e=c.scripts[0];e.parentNode.insertBefore(n,e)}return n.src=e,r._loaded?o():a(r,"load",o,{once:!0}),n},r.setRel=r.setRelStylesheet=function(e){a(c.getElementById(e),"load",function(){this.rel="stylesheet"},{once:!0})}}(window,document);
!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);
!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);
!function(w) {
  w._baseURL = '/';
  w._publicPath = '/assets/js/';
  w._noPushState = false;
  w._noDrawer = false;
  w._noNavbar = false;
  w._noToc = false;
  w._noSearch = false;
  w._search = {
    DATA_URL: '/assets/sitedata.json?no-cache',
    STORAGE_KEY: 'mini-search/',
    INDEX_KEY: 'index--2023-09-07T19:48:09-04:00',
  };
  w._clapButton = true;
}(window);</script>


<script async src="/assets/bower_components/MathJax/es5/tex-mml-chtml.js" id="_MathJax"></script>


<!--[if gt IE 8]><!---->

  




<link rel="stylesheet" href="/assets/css/hydejack-9.1.6.css" id="_stylePreload">
<link rel="stylesheet" href="/assets/icomoon/style.css" id="_iconsPreload">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Slab:700%7CNoto+Sans:400,400i,700,700i&display=swap" id="_fontsPreload">



  <style id="_pageStyle">

html{--accent-color: rgb(3,29,52);--accent-color-faded: rgba(3, 29, 52, 0.5);--accent-color-highlight: rgba(3, 29, 52, 0.1);--accent-color-darkened: #010910;--theme-color: rgb(3,29,52)}
</style>


<!--<![endif]-->




</head>

<body class="no-break-layout">
  


<hy-push-state
  id="_pushState"
  replace-selector="#_main"
  link-selector="a[href]:not([href^='/assets/']):not(.external):not(.no-push-state)"
  script-selector="script"
  duration="500"
  hashchange
>
  
  
  <div id="_navbar" class="navbar fixed-top">
  <div class="content">
    <span class="sr-only">Jump to:</span>
    <div class="nav-btn-bar">
      <a id="_menu" class="nav-btn no-hover" href="#_drawer--opened">
        <span class="sr-only">Navigation</span>
        <span class="icon-menu"></span>
      </a>
      <div class="nav-span"></div>
    </div>
  </div>
</div>
<hr class="sr-only" hidden />

  <main
  id="_main"
  class="content layout-post"
  role="main"
>
  <nav id="breadcrumbs" class="screen-only"><ul>
  
  
    <li><a href="/">home</a></li>
    
      <li>
        
          <span>/</span>
          
          
          <a href="/research_projects/">research_projects</a>
        
      </li>
    
      <li>
        
          <span>/</span>
          <span>2022-08-01-HYD_NN</span>
        
      </li>
    
  
</ul></nav>
  










<article id="post-research_projects-HYD_NN" class="page post mb6" role="article">
  <header>
    <h1 class="post-title flip-project-title">
      
        A Hybrid Network Combining Cnn and Transformer Encoder to Classify Mosquitoes Based on Wing Beat Frequencies
      
    </h1>

    <div class="post-date">
      
      <span class="ellipsis mr1">
        <time datetime="2022-08-01T00:00:00-04:00">01 Aug 2022</time> in <span>Research_projects</span> 
      </span>
      
        
          
          
          
            
            
            <span class="ellipsis" data-tippy-content="Last modified at: 07 Sep 2023">
              <span class="sr-only">Last modified at:</span>
              <span class="icon-history"></span>
              <time datetime="2023-09-07T11:19:31-04:00">2023-09-07</time>
            </span>
          
        
      
    </div>

    
    
      
        <div class="img-wrapper lead aspect-ratio sixteen-nine flip-project-img">
          


<img
  
    src="/assets/img/blog/arc1.png"
    srcset="/assets/img/blog/arc1.png 1060w,/assets/img/blog/arc1.png 530w,/assets/img/blog/arc1.png 265w"
    
  
  alt="A Hybrid Network Combining Cnn and Transformer Encoder to Classify Mosquitoes Based on Wing Beat Frequencies"
  
  
  width="864"
  height="486"
  loading="lazy"
/>

        </div>
      
      
    

    



  
    <p class="note-sm" >
      A Hybrid Network Combining Cnn and Transformer Encoder to Classify Mosquitoes Based on Wing Beat Frequencies

    </p>
  


  </header>

  
    <hr />
<h2 id="the-reason-for-this-project">The reason for this project</h2>
<p>Whenever I visit places with mosquitoes around, I am the one who gets bitten a lot compared to others (My blood is tasty). At this time, I was taking my higher-level undergraduate classes as a junior in college, where I had to come up with project ideas for my courses. My brain whispered, “Why not make a machine to kill all the bloody mosquitoes?”. The first thing I looked up was, will the world survive without mosquitoes? The answer is absolutely not! So killing only which bit me seems fair. Hence, the machine should be able to detect mosquitoes and kill them somehow. The detection part is okay, but the killing part by automation seems a bit dangerous as pointing lasers can be harmful if false positives occur in the system that can hurt humans. Finally, after much thought, I had to settle for building the first part of my idea and leave the killing to the mosquito-killing lamps. (You will be thrilled to know that the first part is as important if not more important than building the second one as you read this post.)</p>

<h2 id="global-problem">Global problem</h2>
<p>Check out the abstract of the paper. I promise its just few lines.</p>

<h2 id="the-process">The process</h2>

<p class="message"><strong>NOTE</strong>:I am just going to present different parts of the project on the surface and important ones a bit deep. If you wanna know the whole thing please go to the paper where it is clearly explained or reach out to me:)</p>
<ol>
  <li>Research<br />
The first task is to find out whats the current praticies and the history of killing I mean playing with mosquitoes.</li>
</ol>

<blockquote>
  <p><strong><em>“There is no better teacher than history in determining the future. There are decades where nothing happens, and there are weeks where decades happen.”</em></strong> – Charlie Munger and Vladimir Lenin</p>
</blockquote>

<p>All of the research about mosquito detection/classification conducted can be catagoried into three parts which are Geospatial-based Approaches, Visual based Approaches, and Audio based Approaches. Although the studies I refered in the papar showed impressive results, the authors expressed that
the data collected is informative but costly to collect, and places one wants to predict mosquito abundance might not have such
detailed data as such places are socioeconomically disadvantaged.</p>

<p>[8]shows that it is possible to make high-quality Mosquito wingbeat recordings with ordinary smartphones, even with a noisy
background. Since mosquitoes rarely fly faster than one meter per second, they also discovered that the Doppler effect is
insignificant for such recordings, with a recording error of about 2 Hz for mosquitoes up to 10 cm away from the microphone.</p>

<ol>
  <li>Data preprocessing<br />
I have taken the dataset from the study[8]. It has 1381 files, including all 23 species of mosquitoes.
 Most audio files
had 8Khz as the sample rate, and the remaining files had 44.1Khz and 48Khz as sampling rates. Audio durations range from 0 to
600 seconds for the files. The total duration of all the files is around 33k seconds. Used Torchaudio for data analysis.</li>
</ol>

<p>first, we convert all the files into WAV format, then we manually remove any part of the
video that is not the wingbeat(other sounds or no sound), and previous studies removed noisy wingbeat audio clips, which we did
not do in this analysis as we believe learning to detect wingbeats in noisy backgrounds will be a helpful feature in the actual
application of the Model in real-time. Second, we divided the audio clips into 1.5-second chunks without overlapping such that
no same information gets shared among train and test data. Last, we downsample all the audio files to 8Khz, the lowest in the
dataset, in accordance with Nyquist–Shannon sampling theorem used by previous works[8].</p>

<ol>
  <li>Approach:<br />
Our approach consists of CNNs and transformer encoders. CNN’s structure is inspired by the human brain’s primary visual
cortex(V1). CNN layers are designed to capture the functions of simple and complex cells in V1. The function of simple cells can
be best described as a linear function of the input in spatially confined receptive field[26]. The detector units in CNN have this
function. On the other hand, Complex cells are resilient to little changes in the feature’s position. Pooling units of CNNs have the
same function. Sparse interactions, parameter sharing, and equivariant representations, these essential properties of CNN that
make them more computationally efficient and performance boosters in various tasks[27]. It is shown that CNN has the
extraordinary ability to detect patterns in images[28]and Audio[22].</li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">conv_block</span><span class="p">(</span><span class="n">n_in</span><span class="p">,</span> <span class="n">n_out</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">stride</span><span class="p">,</span> <span class="n">conv_bias</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">spin_conv</span><span class="p">():</span>
    <span class="n">conv</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">Conv1d</span><span class="p">(</span><span class="n">n_in</span><span class="p">,</span> <span class="n">n_out</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="n">stride</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="n">conv_bias</span><span class="p">)</span>
    <span class="n">nn</span><span class="p">.</span><span class="n">init</span><span class="p">.</span><span class="nf">kaiming_normal_</span><span class="p">(</span><span class="n">conv</span><span class="p">.</span><span class="n">weight</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">conv</span>
  <span class="k">return</span> <span class="n">nn</span><span class="p">.</span><span class="nc">Sequential</span><span class="p">(</span>
                    <span class="nf">spin_conv</span><span class="p">(),</span>
                    <span class="n">nn</span><span class="p">.</span><span class="nc">Dropout</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mf">0.1</span><span class="p">),</span>
                    <span class="n">nn</span><span class="p">.</span><span class="nc">Sequential</span><span class="p">(</span>
                        <span class="nc">TransposeLast</span><span class="p">(),</span>
                        <span class="nc">Fp32LayerNorm</span><span class="p">(</span><span class="n">n_out</span><span class="p">,</span> <span class="n">elementwise_affine</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
                        <span class="nc">TransposeLast</span><span class="p">(),</span>
                    <span class="p">),</span>
                    <span class="n">nn</span><span class="p">.</span><span class="nc">GELU</span><span class="p">(),</span>
                <span class="p">)</span>
<span class="k">def</span> <span class="nf">make_conv_layers</span><span class="p">():</span>
        <span class="n">in_d</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">conv_dim</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">256</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">)]</span> <span class="o">+</span> <span class="p">[(</span><span class="mi">256</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="p">[(</span><span class="mi">256</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)]</span> <span class="o">+</span> <span class="p">[(</span><span class="mi">256</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)]</span>
        <span class="n">conv_layers</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">ModuleList</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">cl</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">conv_dim</span><span class="p">):</span>
            <span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">stride</span><span class="p">)</span> <span class="o">=</span> <span class="n">cl</span>
            <span class="n">conv_layers</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span>
                <span class="nf">conv_block</span><span class="p">(</span>
                    <span class="n">in_d</span><span class="p">,</span>
                    <span class="n">dim</span><span class="p">,</span>
                    <span class="n">k</span><span class="p">,</span>
                    <span class="n">stride</span><span class="p">,</span>
                    <span class="n">conv_bias</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">in_d</span> <span class="o">=</span> <span class="n">dim</span> 
        <span class="k">return</span> <span class="n">conv_layers</span>
</code></pre></div></div>

<p>Model contains a multi-layer convolutional feature encoder f: X-¿Z, which takes raw Audio as input and outputs latent
representations(Z). After adding positional embeddings, these representations go into transformer encoder g: Z-
¿C as shown in the fig1, concatenated with the classification token, to get global context vectors capturing information about the
sequence, then the classification vector output is sent to a fully connected network for classification.
The convolutional feature encoder has seven layers. Each layer has three components which are conv1d,
layer normalization, and activation function GELU. Each layer has a different kernel size and stride value, as shown in table2. We
use a dropout value of 0.1 during training. Most configurations are the same as Wav2vec2.0[22]. We also use a transformer in our
Model. A transformer consists of an encoder and a decoder; as our Model is designed for the classification task, we use a
Transformer encoder-only architecture which contains multi-head attention, residual connections, feed-forward layers, and layer
normalization, the same as BERT[29]With classification token appended at the end rather than the usual starting position in BERT. We have two encoder layers with four heads in each and
a dimension of 2048 for feed-forward networks using a dropout of 0.1. The last classification has 23 outputs, one for each species.
These three parts are connected as shown in Table Fig1.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">wavmosLit</span><span class="p">(</span><span class="n">pl</span><span class="p">.</span><span class="n">LightningModule</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
        <span class="n">self</span>
        <span class="p">):</span>
        <span class="nf">super</span><span class="p">(</span><span class="n">wavmosLit</span><span class="p">,</span> <span class="n">self</span><span class="p">).</span><span class="nf">__init__</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">precision_all</span> <span class="o">=</span> <span class="nc">Precision</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="sh">"</span><span class="s">multiclass</span><span class="sh">"</span><span class="p">,</span><span class="n">num_classes</span><span class="o">=</span><span class="mi">23</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">precision_global</span> <span class="o">=</span> <span class="nc">Precision</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="sh">"</span><span class="s">multiclass</span><span class="sh">"</span><span class="p">,</span><span class="n">average</span><span class="o">=</span><span class="sh">'</span><span class="s">macro</span><span class="sh">'</span><span class="p">,</span> <span class="n">num_classes</span><span class="o">=</span><span class="mi">23</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">precision_weighted</span> <span class="o">=</span> <span class="nc">Precision</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="sh">"</span><span class="s">multiclass</span><span class="sh">"</span><span class="p">,</span><span class="n">average</span><span class="o">=</span><span class="sh">'</span><span class="s">weighted</span><span class="sh">'</span><span class="p">,</span> <span class="n">num_classes</span> <span class="o">=</span> <span class="mi">23</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">precision_each</span> <span class="o">=</span> <span class="nc">Precision</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="sh">"</span><span class="s">multiclass</span><span class="sh">"</span><span class="p">,</span><span class="n">average</span><span class="o">=</span><span class="sh">'</span><span class="s">none</span><span class="sh">'</span><span class="p">,</span> <span class="n">num_classes</span> <span class="o">=</span> <span class="mi">23</span><span class="p">)</span>
        
        <span class="n">self</span><span class="p">.</span><span class="n">recall_all</span> <span class="o">=</span> <span class="nc">Recall</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="sh">"</span><span class="s">multiclass</span><span class="sh">"</span><span class="p">,</span><span class="n">num_classes</span><span class="o">=</span><span class="mi">23</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">recall_global</span> <span class="o">=</span> <span class="nc">Recall</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="sh">"</span><span class="s">multiclass</span><span class="sh">"</span><span class="p">,</span><span class="n">average</span><span class="o">=</span><span class="sh">'</span><span class="s">macro</span><span class="sh">'</span><span class="p">,</span> <span class="n">num_classes</span><span class="o">=</span><span class="mi">23</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">recall_weighted</span> <span class="o">=</span> <span class="nc">Recall</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="sh">"</span><span class="s">multiclass</span><span class="sh">"</span><span class="p">,</span><span class="n">average</span><span class="o">=</span><span class="sh">'</span><span class="s">weighted</span><span class="sh">'</span><span class="p">,</span> <span class="n">num_classes</span> <span class="o">=</span> <span class="mi">23</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">recall_each</span> <span class="o">=</span> <span class="nc">Recall</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="sh">"</span><span class="s">multiclass</span><span class="sh">"</span><span class="p">,</span><span class="n">average</span><span class="o">=</span><span class="sh">'</span><span class="s">none</span><span class="sh">'</span><span class="p">,</span> <span class="n">num_classes</span> <span class="o">=</span> <span class="mi">23</span><span class="p">)</span>
        
        <span class="n">self</span><span class="p">.</span><span class="n">f1</span> <span class="o">=</span> <span class="nc">F1Score</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="sh">"</span><span class="s">multiclass</span><span class="sh">"</span><span class="p">,</span><span class="n">num_classes</span><span class="o">=</span><span class="mi">23</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">confmat</span> <span class="o">=</span> <span class="nc">ConfusionMatrix</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="sh">"</span><span class="s">multiclass</span><span class="sh">"</span><span class="p">,</span><span class="n">num_classes</span><span class="o">=</span><span class="mi">23</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">valid_acc</span> <span class="o">=</span> <span class="n">torchmetrics</span><span class="p">.</span><span class="nc">Accuracy</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="sh">"</span><span class="s">multiclass</span><span class="sh">"</span><span class="p">,</span><span class="n">num_classes</span><span class="o">=</span><span class="mi">23</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">valid_acc_each</span> <span class="o">=</span>  <span class="n">torchmetrics</span><span class="p">.</span><span class="nc">Accuracy</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="sh">"</span><span class="s">multiclass</span><span class="sh">"</span><span class="p">,</span><span class="n">average</span><span class="o">=</span><span class="sh">'</span><span class="s">none</span><span class="sh">'</span><span class="p">,</span> <span class="n">num_classes</span> <span class="o">=</span> <span class="mi">23</span><span class="p">)</span>
        
        <span class="n">self</span><span class="p">.</span><span class="n">inner_dim</span> <span class="o">=</span> <span class="mi">49</span>
        <span class="n">self</span><span class="p">.</span><span class="n">encoder</span> <span class="o">=</span> <span class="nc">TransformerEncoder</span><span class="p">()</span>
        <span class="c1">#self.cls_emb = nn.Linear(1,49)
</span>        <span class="n">self</span><span class="p">.</span><span class="n">last_layer</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">nn</span><span class="p">.</span><span class="nc">Linear</span><span class="p">(</span>
            <span class="n">self</span><span class="p">.</span><span class="n">inner_dim</span><span class="p">,</span>
            <span class="mi">23</span>
            <span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_global_shared_layer</span> <span class="o">=</span> <span class="n">TORCH_GLOBAL_SHARED_LAYER</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_output</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_output</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">.</span><span class="nf">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">conv</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">_global_shared_layer</span><span class="p">:</span>
             <span class="n">self</span><span class="p">.</span><span class="n">_output</span> <span class="o">=</span> <span class="nf">conv</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_output</span><span class="p">)</span>
        <span class="c1">#self.temp = torch.ones([self._output.shape[0],1,49],device = device)
</span>        <span class="c1">#self.cls_token_emb = self.cls_emb(torch.tensor([50], dtype=torch.float,device = device))
</span>        <span class="c1">#self.temp[:,0,:] = self.cls_token_emb
</span>        <span class="n">self</span><span class="p">.</span><span class="n">_output</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">cat</span><span class="p">((</span><span class="n">self</span><span class="p">.</span><span class="n">_output</span><span class="p">,</span><span class="n">torch</span><span class="p">.</span><span class="nf">ones</span><span class="p">([</span><span class="n">self</span><span class="p">.</span><span class="n">_output</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">,</span><span class="mi">49</span><span class="p">],</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span><span class="p">)),</span><span class="mi">1</span><span class="p">)</span>                         
        <span class="n">self</span><span class="p">.</span><span class="n">_output</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">encoder</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_output</span><span class="p">)</span>
        <span class="n">model_out</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">last_layer</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_output</span><span class="p">[:,</span><span class="mi">256</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">model_out</span>

    <span class="k">def</span> <span class="nf">training_step</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">,</span> <span class="n">batch_idx</span><span class="p">):</span>
        <span class="n">inputs</span><span class="p">,</span> <span class="n">targets</span> <span class="o">=</span> <span class="n">batch</span>
        
        <span class="n">outputs</span> <span class="o">=</span> <span class="nf">self</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
        
        <span class="n">loss</span> <span class="o">=</span>  <span class="nf">loss_function</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">loss</span><span class="sh">"</span><span class="p">:</span> <span class="n">loss</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="n">stage</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>

        <span class="n">train_ids</span><span class="p">,</span><span class="n">test_ids</span> <span class="o">=</span> <span class="n">spilts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> 
        <span class="n">self</span><span class="p">.</span><span class="n">training_data</span> <span class="o">=</span> <span class="nc">CustomImageDataset</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">train_subsampler</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">utils</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="nc">SubsetRandomSampler</span><span class="p">(</span><span class="n">train_ids</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">test_subsampler</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">utils</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="nc">SubsetRandomSampler</span><span class="p">(</span><span class="n">test_ids</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">train_dataloader</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
    
        <span class="n">train_loader</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">utils</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="nc">DataLoader</span><span class="p">(</span>
                      <span class="n">self</span><span class="p">.</span><span class="n">training_data</span><span class="p">,</span> 
                      <span class="n">batch_size</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">sampler</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">train_subsampler</span><span class="p">,</span><span class="n">num_workers</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span><span class="n">pin_memory</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">train_loader</span>

    <span class="k">def</span> <span class="nf">val_dataloader</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
    
        <span class="n">val_loader</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">utils</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="nc">DataLoader</span><span class="p">(</span>
                      <span class="n">self</span><span class="p">.</span><span class="n">training_data</span><span class="p">,</span>
                      <span class="n">batch_size</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">sampler</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">test_subsampler</span><span class="p">,</span><span class="n">num_workers</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span><span class="n">pin_memory</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">val_loader</span>
    
    <span class="k">def</span> <span class="nf">validation_step</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">,</span> <span class="n">batch_idx</span><span class="p">):</span>
        <span class="n">inputs</span><span class="p">,</span> <span class="n">targets</span> <span class="o">=</span> <span class="n">batch</span>
        
        <span class="n">outputs</span> <span class="o">=</span> <span class="nf">self</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
        
        <span class="n">loss</span> <span class="o">=</span>  <span class="nf">loss_function</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">valid_acc</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">valid_acc_each</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">recall_all</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">recall_global</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">recall_weighted</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">recall_each</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">precision_all</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">precision_global</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">precision_weighted</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">precision_each</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">confmat</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">val_loss</span><span class="sh">"</span><span class="p">:</span> <span class="n">loss</span><span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">training_epoch_end</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">training_step_outputs</span><span class="p">):</span>
        <span class="n">avg_loss</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">stack</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="sh">'</span><span class="s">loss</span><span class="sh">'</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">training_step_outputs</span><span class="p">]).</span><span class="nf">mean</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="sh">"</span><span class="s">T_avg_loss</span><span class="sh">"</span><span class="p">,</span> <span class="n">avg_loss</span><span class="p">,</span><span class="n">prog_bar</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">wandb</span><span class="p">.</span><span class="nf">log</span><span class="p">({</span><span class="sh">"</span><span class="s">T_avg_loss</span><span class="sh">"</span><span class="p">:</span> <span class="n">avg_loss</span><span class="p">})</span>
        
    <span class="k">def</span> <span class="nf">validation_epoch_end</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">outputs</span><span class="p">):</span>
        <span class="n">avg_loss</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">stack</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="sh">'</span><span class="s">val_loss</span><span class="sh">'</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">outputs</span><span class="p">]).</span><span class="nf">mean</span><span class="p">()</span>

        <span class="n">self</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="sh">"</span><span class="s">val_loss</span><span class="sh">"</span><span class="p">,</span><span class="n">avg_loss</span><span class="p">,</span><span class="n">prog_bar</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="sh">"</span><span class="s">val_acc</span><span class="sh">"</span><span class="p">,</span><span class="n">self</span><span class="p">.</span><span class="n">valid_acc</span><span class="p">.</span><span class="nf">compute</span><span class="p">(),</span><span class="n">prog_bar</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">wandb</span><span class="p">.</span><span class="nf">log</span><span class="p">({</span><span class="sh">"</span><span class="s">val_loss</span><span class="sh">"</span><span class="p">:</span> <span class="n">avg_loss</span><span class="p">,</span>
                   <span class="sh">'</span><span class="s">val_acc</span><span class="sh">'</span><span class="p">:</span><span class="n">self</span><span class="p">.</span><span class="n">valid_acc</span><span class="p">.</span><span class="nf">compute</span><span class="p">(),</span>
                  <span class="sh">"</span><span class="s">recall_all</span><span class="sh">"</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">recall_all</span><span class="p">.</span><span class="nf">compute</span><span class="p">(),</span>

                  <span class="sh">"</span><span class="s">recall_global</span><span class="sh">"</span><span class="p">:</span><span class="n">self</span><span class="p">.</span><span class="n">recall_global</span><span class="p">.</span><span class="nf">compute</span><span class="p">(),</span>
                  <span class="sh">"</span><span class="s">recall_weighted</span><span class="sh">"</span><span class="p">:</span><span class="n">self</span><span class="p">.</span><span class="n">recall_weighted</span><span class="p">.</span><span class="nf">compute</span><span class="p">(),</span>
        
                  <span class="sh">"</span><span class="s">precision_all</span><span class="sh">"</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">precision_all</span><span class="p">.</span><span class="nf">compute</span><span class="p">(),</span>
                  <span class="sh">"</span><span class="s">precision_global</span><span class="sh">"</span><span class="p">:</span><span class="n">self</span><span class="p">.</span><span class="n">precision_global</span><span class="p">.</span><span class="nf">compute</span><span class="p">(),</span>
                  <span class="sh">"</span><span class="s">precision_weighted</span><span class="sh">"</span><span class="p">:</span><span class="n">self</span><span class="p">.</span><span class="n">precision_weighted</span><span class="p">.</span><span class="nf">compute</span><span class="p">(),</span>
    
                  <span class="c1">#"confusion_matrix": self.confmat.compute()
</span>                  <span class="p">})</span>
        <span class="n">wandb</span><span class="p">.</span><span class="nf">log</span><span class="p">({</span><span class="sa">f</span><span class="sh">"</span><span class="s">test_acc_each/acc-</span><span class="si">{</span><span class="n">ii</span><span class="si">}</span><span class="sh">"</span><span class="p">:</span> <span class="n">loss</span> <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">loss</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">valid_acc_each</span><span class="p">.</span><span class="nf">compute</span><span class="p">())})</span>
        <span class="n">wandb</span><span class="p">.</span><span class="nf">log</span><span class="p">({</span><span class="sa">f</span><span class="sh">"</span><span class="s">recall_each/recall_each-</span><span class="si">{</span><span class="n">ii</span><span class="si">}</span><span class="sh">"</span><span class="p">:</span> <span class="n">loss</span> <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">loss</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">precision_each</span><span class="p">.</span><span class="nf">compute</span><span class="p">())})</span>
        <span class="n">wandb</span><span class="p">.</span><span class="nf">log</span><span class="p">({</span><span class="sa">f</span><span class="sh">"</span><span class="s">precision_each/precision_each-</span><span class="si">{</span><span class="n">ii</span><span class="si">}</span><span class="sh">"</span><span class="p">:</span> <span class="n">loss</span> <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">loss</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">precision_each</span><span class="p">.</span><span class="nf">compute</span><span class="p">())})</span>
        
        <span class="nf">print</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">training_data</span><span class="p">.</span><span class="n">lab_dict</span><span class="p">.</span><span class="nf">items</span><span class="p">()))</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">confmat</span><span class="p">.</span><span class="nf">compute</span><span class="p">())</span>
        <span class="n">self</span><span class="p">.</span><span class="n">confmat</span><span class="p">.</span><span class="nf">reset</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">valid_acc</span><span class="p">.</span><span class="nf">reset</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">valid_acc_each</span><span class="p">.</span><span class="nf">reset</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">recall_all</span><span class="p">.</span><span class="nf">reset</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">recall_global</span><span class="p">.</span><span class="nf">reset</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">recall_weighted</span><span class="p">.</span><span class="nf">reset</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">recall_each</span><span class="p">.</span><span class="nf">reset</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">precision_all</span><span class="p">.</span><span class="nf">reset</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">precision_global</span><span class="p">.</span><span class="nf">reset</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">precision_weighted</span><span class="p">.</span><span class="nf">reset</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">precision_each</span><span class="p">.</span><span class="nf">reset</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">{</span><span class="sh">'</span><span class="s">val_loss</span><span class="sh">'</span><span class="p">:</span> <span class="n">avg_loss</span><span class="p">}</span><span class="c1">#, 'log': tensorboard_logs}
</span>    
    <span class="k">def</span> <span class="nf">configure_optimizers</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">optim</span><span class="p">.</span><span class="nc">Adam</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="nf">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">)),</span><span class="n">capturable</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">scheduler</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">optim</span><span class="p">.</span><span class="n">lr_scheduler</span><span class="p">.</span><span class="nc">MultiStepLR</span><span class="p">(</span><span class="n">optimizer</span><span class="p">,</span> <span class="n">milestones</span><span class="o">=</span><span class="p">[</span><span class="mi">60</span><span class="p">],</span> <span class="n">gamma</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">optimizer</span><span class="p">],</span> <span class="p">[</span><span class="n">scheduler</span><span class="p">]</span>
</code></pre></div></div>

<p>To evaluate our approach, we choose the PyTorch framework to train the Model:
1.We ran a hyperparameter search on the learning rate, revealing 0.0004 to be suitable.
2.We analyzed batch sizes starting from 32 to 128 in multiples of 32 and found that size 64 gives the best performance,
whereas the batch size of 128 resulted in complete hardware capacity utilization.
3.The best-performing version used 64 as batch size and 2 ∗(0.0004) as the learning rate.
We trained on every fold for 80 epochs before testing. Model parameters were optimized by Adam optimizer with standard
configuration. The Model also used the LR scheduler with a milestone at the 60th epoch decaying by 0.1. The loss function used
is Cross Entropy Loss, as it is used in training multi-class problems.</p>

<h2 id="results">Results</h2>

<table>
  <thead>
    <tr>
      <th> </th>
      <th>Precision</th>
      <th>Recall</th>
      <th>Accuracy</th>
      <th>Precision PW</th>
      <th>PM</th>
      <th>Recall RW</th>
      <th>RM</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Average</td>
      <td>0.8127</td>
      <td>0.8127</td>
      <td>0.8127</td>
      <td>0.7209</td>
      <td>0.8127</td>
      <td>0.8127</td>
      <td>0.7093</td>
    </tr>
    <tr>
      <td>SD</td>
      <td>0.0093</td>
      <td>0.0093</td>
      <td>0.0093</td>
      <td>0.0456</td>
      <td>0.0093</td>
      <td>0.0093</td>
      <td>0.0316</td>
    </tr>
  </tbody>
</table>

<p>The hybrid model achieved an overall 81.27%(±0.93) accuracy with Precision and Recall equalling accuracy up to six decimal
points. Recall weighed also equals with Recall and differs in standard deviation about (±0.9311), and Precision weighted achieved
81.70%(±1.02), Macro version of the precision score achieved is 72.09%(±4.56), Recall macro version percentage is
70.93%(±3.16) showcasing its effectiveness in classifying mosquito species based on wingbeat sounds. Notably, both Precision and Recall closely matched this accuracy up to six decimal points, indicating precise performance. The model excelled in identifying Anopheles minimus and Culiseta incidens due to data availability and unique wingbeat frequency distributions. However, it struggled with Anopheles quadrimaculatus and Aedes mediovittatus, which had limited data. Despite some misclassifications, the model showed improvement in distinguishing species with overlapping wingbeat frequencies which was a big problem in previous models. Overall, its robust and balanced metrics, with standard deviations below 3%, demonstrate its reliability as a classifier.</p>

<p class="figure"><img src="/assets/img/result_f1_acc.png" alt="Full-width image" class="lead" width="800" height="100" />
A caption to an image.</p>

<p class="figure"><img src="/assets/img/result_f1_acc_sd.png" alt="Full-width image" class="lead" width="800" height="100" />
A caption to an image.</p>

<p>Importantly, the proposed multi-class model’s accuracy surpassed that of previous studies that used spatial information, achieving higher accuracy levels, even though it relied solely on raw acoustic data from mosquito wingbeats. This model outperformed studies with accuracy levels of 65%, 78.12%, and 80%, showcasing its remarkable performance in mosquito species classification.</p>

<p class="figure"><img src="/assets/img/result_recall_prec_avg.png" alt="Full-width image" class="lead" width="800" height="100" />
A caption to an image.</p>

<p class="figure"><img src="/assets/img/result_recall_prec_std.png" alt="Full-width image" class="lead" width="800" height="100" />
A caption to an image.</p>

<p class="figure"><img src="/assets/img/results_confu_matrix.png" alt="Full-width image" class="lead" width="800" height="100" />
A caption to an image.</p>

<h2 id="code-blocks">Code blocks</h2>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Example can be run directly in your JavaScript console</span>

<span class="c1">// Create a function that takes two arguments and returns the sum of those</span>
<span class="c1">// arguments</span>
<span class="kd">var</span> <span class="nx">adder</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Function</span><span class="p">(</span><span class="dl">"</span><span class="s2">a</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">b</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">return a + b</span><span class="dl">"</span><span class="p">);</span>

<span class="c1">// Call the function</span>
<span class="nf">adder</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>
<span class="c1">// &gt; 8</span>
</code></pre></div></div>

<h2 id="math">Math</h2>
<p>Lorem ipsum \(f(x) = x^2\).</p>

\[\begin{aligned}
  \phi(x,y) &amp;= \phi \left(\sum_{i=1}^n x_ie_i, \sum_{j=1}^n y_je_j \right) \\[2em]
            &amp;= \sum_{i=1}^n \sum_{j=1}^n x_i y_j \phi(e_i, e_j)            \\[2em]
            &amp;= (x_1, \ldots, x_n)
               \left(\begin{array}{ccc}
                 \phi(e_1, e_1)  &amp; \cdots &amp; \phi(e_1, e_n) \\
                 \vdots          &amp; \ddots &amp; \vdots         \\
                 \phi(e_n, e_1)  &amp; \cdots &amp; \phi(e_n, e_n)
               \end{array}\right)
               \left(\begin{array}{c}
                 y_1    \\
                 \vdots \\
                 y_n
               \end{array}\right)
\end{aligned}\]

<h2 id="message-boxes">Message boxes</h2>
<p class="message"><strong>NOTE</strong>: You can add a message box.</p>

<h2 id="large-text">Large text</h2>
<p class="lead">You can add large text.</p>

<h2 id="large-images">Large images</h2>
<p><img src="https://via.placeholder.com/800x100" alt="Full-width image" class="lead" width="800" height="100" /></p>

<h2 id="captions-to-images">Captions to images</h2>
<p class="figure"><img src="https://via.placeholder.com/800x100" alt="Full-width image" class="lead" width="800" height="100" />
A caption to an image.</p>

<h2 id="large-quotes">Large quotes</h2>
<blockquote class="lead">
  <p>You can make a quote “pop out”.</p>
</blockquote>

<h2 id="faded-text">Faded text</h2>
<p class="faded">I’m faded, faded, faded.</p>


  
</article>



  <hr class="dingbat related mb6" />






  
     


  <aside class="about related mt4 mb4" role="complementary">
    
    

<div class="author mt4">
  

  
    


<img
  
    src="https://via.placeholder.com/128x128"
    srcset="https://via.placeholder.com/128x128 1x,https://via.placeholder.com/256x256 2x"
    
  
  alt="shivacharan oruganti"
  class="avatar"
  
  width="120"
  height="120"
  loading="lazy"
/>

  

  
  
  <h2  class="page-title hr-bottom">
    About
  </h2>

  <p>I am currently a graduate student at Boston University pursuing a Master’s degree in Artificial Intelligence. I have done my bachelors in computer science and engineering from VIT,vellore.</p>


  <div class="sidebar-social">
    <span class="sr-only">Social:</span>
<ul>
  
    
      



  

  
  
  
  

  

  

  <li>
    <a href="https://twitter.com/shivaco22" title="Twitter" class="no-mark-external">
      <span class="icon-twitter"></span>
      <span class="sr-only">Twitter</span>
    </a>
  </li>


    
      



  

  
  
  
  

  

  

  <li>
    <a href="https://github.com/shivacharan22" title="GitHub" class="no-mark-external">
      <span class="icon-github"></span>
      <span class="sr-only">GitHub</span>
    </a>
  </li>


    
      



  

  
  
  
  

  

  

  <li>
    <a href="mailto:shivaco@bu.edu" title="Email" class="no-mark-external">
      <span class="icon-mail"></span>
      <span class="sr-only">Email</span>
    </a>
  </li>


    
      



  

  
  
  
  

  

  

  <li>
    <a href="https://instagram.com/shivacharano" title="Instagram" class="no-mark-external">
      <span class="icon-instagram"></span>
      <span class="sr-only">Instagram</span>
    </a>
  </li>


    
      



  

  
  
  
  

  

  

  <li>
    <a href="https://www.linkedin.com/in/<firstname-lastname-string>" title="LinkedIn" class="no-mark-external">
      <span class="icon-linkedin2"></span>
      <span class="sr-only">LinkedIn</span>
    </a>
  </li>


    
  
</ul>

  </div>
</div>

  </aside>


  

  
  

  
    


  

  
  

  
    

  


  
<footer class="content" role="contentinfo">
  <hr/>
  
    <p><small class="copyright">© 2021. All rights reserved.
</small></p>
  
  
    <p><small>Powered by <a class="external" href="https://hydejack.com/">Hydejack</a> v<span id="_version">9.1.6</span></small></p>
  <hr class="sr-only"/>
</footer>


</main>

  <hy-drawer
  id="_drawer"
  class=""
  side="left"
  threshold="10"
  noscroll
  
>
  <header id="_sidebar" class="sidebar" role="banner">
    




<div class="sidebar-bg sidebar-overlay" style="background-color:rgb(3,29,52);background-image:url(/assets/img/bgi.jpeg)"></div>

    <div class="sidebar-sticky">
  <div class="sidebar-about">
    
      <a class="no-hover" href="/" tabindex="-1">
        <img src="/assets/img/prof.JPG" class="avatar" alt="shivacharan oruganti" width="120" height="120" loading="lazy" />
      </a>
    
    <a class="sidebar-title" href="/"><h2 class="h1">shivacharan oruganti</h2></a>
    
    
      <p class="">
        #Grad Student #boston_university

      </p>
    
  </div>

  <nav class="sidebar-nav heading" role="navigation">
    <span class="sr-only">Navigation:</span>
<ul>
  
    
      
      <li>
        <a
          id="_drawer--opened"
          href="/"
          class="sidebar-nav-item "
          
        >
          Research-projects
        </a>
      </li>
    
      
      <li>
        <a
          
          href="/about/"
          class="sidebar-nav-item "
          
        >
          About
        </a>
      </li>
    
  
</ul>

  </nav>

  
  <div class="sidebar-social">
    <span class="sr-only">Social:</span>
<ul>
  
    
      



  

  
  
  
  

  

  

  <li>
    <a href="https://twitter.com/shivaco22" title="Twitter" class="no-mark-external">
      <span class="icon-twitter"></span>
      <span class="sr-only">Twitter</span>
    </a>
  </li>


    
      



  

  
  
  
  

  

  

  <li>
    <a href="https://github.com/shivacharan22" title="GitHub" class="no-mark-external">
      <span class="icon-github"></span>
      <span class="sr-only">GitHub</span>
    </a>
  </li>


    
      



  

  
  
  
  

  

  

  <li>
    <a href="mailto:shivaco@bu.edu" title="Email" class="no-mark-external">
      <span class="icon-mail"></span>
      <span class="sr-only">Email</span>
    </a>
  </li>


    
      



  

  
  
  
  

  

  

  <li>
    <a href="https://instagram.com/shivacharano" title="Instagram" class="no-mark-external">
      <span class="icon-instagram"></span>
      <span class="sr-only">Instagram</span>
    </a>
  </li>


    
      



  

  
  
  
  

  

  

  <li>
    <a href="https://www.linkedin.com/in/<firstname-lastname-string>" title="LinkedIn" class="no-mark-external">
      <span class="icon-linkedin2"></span>
      <span class="sr-only">LinkedIn</span>
    </a>
  </li>


    
  
</ul>

  </div>
</div>
  </header>
</hy-drawer>
<hr class="sr-only" hidden />

</hy-push-state>


  <!--[if gt IE 10]><!---->
  <script nomodule>!function(){var t,n=document.createElement("script");!("noModule"in n)&&"onbeforeload"in n&&(t=!1,document.addEventListener("beforeload",function(e){if(e.target===n)t=!0;else if(!e.target.hasAttribute("nomodule")||!t)return;e.preventDefault()},!0),n.type="module",n.src=".",document.head.appendChild(n),n.remove())}();
</script>
  <script src="/assets/js/hydejack-9.1.6.js" type="module"></script>
  <script src="/assets/js/LEGACY-hydejack-9.1.6.js" nomodule defer></script>
  

  

<!--<![endif]-->
  <!-- <script>
  document.querySelector('hy-push-state').setAttribute('prefetch', '');

  document.querySelectorAll('.sidebar a[href^="/"]').forEach(function (el) { 
    el.addEventListener('click', function (e) {
      if (el.pathname === window.location.pathname) {
        e.preventDefault();
        e.stopPropagation();
        document.querySelector('hy-drawer').close();
      }
    });
  });
</script> -->

<!--
Code for integrating CloudFlare's email protection with Hydejack's single page app loading.
-->
<script>
  document.getElementById('_pushState').addEventListener('hy-push-state-after', function (e) {
    function e(e){
      (console.error?console.error:console.log).call(console,e)
    }

    function t(e){
      return l.innerHTML='<a href="'+e.replace(/"/g,"&quot;")+'"></a>',l.childNodes[0].getAttribute("href")
    }

    function r(e,t){
      var r=e.substr(t,2);return parseInt(r,16)
    }

    function n(e,n){
      for(var o="",c=r(e,n),a=n+2;a<e.length;a+=2){
        var l=r(e,a)^c;
        o+=String.fromCharCode(l)
      }
      return t(o)
    }

    var o="/cdn-cgi/l/email-protection#",
        c=".__cf_email__",
        a="data-cfemail",
        l=document.createElement("div");

    !function(){
      for(var t=document.getElementsByTagName("a"),r=0;r<t.length;r++)
        try{
          var c=t[r],a=c.href.indexOf(o);
          a>-1&&(c.href="mailto:"+n(c.href,a+o.length))
        }catch(t){
          e(t)
        }
    }(),
    function(){
      for(var t=document.querySelectorAll(c),r=0;r<t.length;r++)
        try{
          var o=t[r],l=n(o.getAttribute(a),0),i=document.createTextNode(l);
          o.parentNode.replaceChild(i,o)
        }catch(t){
          e(t)
        }
    }()
  });
</script>





<div hidden>
  
  <h2 class="sr-only">Templates (for web app):</h2>

  <template id="_animation-template">
  <div class="animation-main fixed-top">
    <nav id="breadcrumbs" class="screen-only"><ul>
  
  
</ul></nav>
    <div class="content">
      <div class="page"></div>
    </div>
  </div>
</template>

  <template id="_loading-template">
  <div class="loading nav-btn fr">
    <span class="sr-only">Loading…</span>
    <span class="icon-cog"></span>
  </div>
</template>

  <template id="_error-template">
  <div class="page">
    <h1 class="page-title">Error</h1>
    
    
    <p class="lead">
      Sorry, an error occurred while loading <a class="this-link" href=""></a>.

    </p>
  </div>
</template>

  <template id="_permalink-template">
  <a href="#" class="permalink">
    <span class="sr-only">Permalink</span>
    <span class="content-hash"></span>
  </a>
</template>

</div>


</body>
</html>
